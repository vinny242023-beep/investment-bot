import logging
import sqlite3
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, CallbackContext

# Токен бота (рекомендуется использовать переменные окружения)
BOT_TOKEN = "8203632125:AAFl3OqXf4mKeijmA1-YFmJGP9UMUbCxl0I"

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# =====================================================================
# МАКСИМАЛЬНО ПОДРОБНАЯ БАЗА ЗНАНИЙ ПО ИНВЕСТИЦИЯМ
# =====================================================================

# --- КНИГА 1: САМЫЙ БОГАТЫЙ ЧЕЛОВЕК В ВАВИЛОНЕ ---
BABYLON_BOOK = """
📖 САМЫЙ БОГАТЫЙ ЧЕЛОВЕК В ВАВИЛОНЕ — Джордж Клейсон

═══════════════════════════════════════════════════════════════

ВВЕДЕНИЕ

Эта книга — собрание притч о финансовой мудрости древнего Вавилона.
Вавилон был одним из богатейших городов древности благодаря финансовой
грамотности его жителей. Уроки из этой книги актуальны и сегодня.

═══════════════════════════════════════════════════════════════

ГЛАВА 1. ЧЕЛОВЕК, КОТОРЫЙ ЖЕЛАЛ ЗОЛОТА

📌 Основная мысль:
Богатство начинается с желания и знаний о том, как его достичь.

Сюжет:
Двое друзей Аркада — Бансир и Кобби — приходят к нему с вопросом:
"Мы работали всю жизнь так же упорно, как и ты. Почему ты богат, а мы бедны?"

Аркад отвечает:
"Я научился простым законам денег. Я узнал, что богатство приходит к тому,
кто откладывает хотя бы десятую часть своего заработка."

💡 Ключевая идея:
Не важно, сколько ты зарабатываешь. Важно, сколько ты откладываешь.

Пример:
Если зарабатываешь 30 000₽ в месяц, отложи 3 000₽.
Через год: 36 000₽.
Через 5 лет (без инвестиций): 180 000₽.
Через 10 лет: 360 000₽.

А если эти деньги инвестировать под 10% годовых:
Через 10 лет: ~570 000₽.
Через 20 лет: ~2 000 000₽.

🎯 Вывод:
Начни откладывать прямо сейчас. Даже если сумма кажется маленькой.

═══════════════════════════════════════════════════════════════

ГЛАВА 2. СЕМЬ ПРАВИЛ УПРАВЛЕНИЯ ДЕНЬГАМИ

📌 Основная мысль:
Следуя семи простым правилам, любой может стать богатым.

ПРАВИЛО 1: НАЧНИ НАПОЛНЯТЬ СВОЙ КОШЕЛЁК

"За каждые 10 монет, что приходят в твой кошелёк, трать не более 9."

💡 Смысл:
Откладывай минимум 10% дохода. Это твой капитал.

Пример:
Зарплата 50 000₽ → откладывай 5 000₽.

Как это сделать?
- Автоматический перевод на накопительный счёт в день зарплаты.
- "Заплати сначала себе" — первые деньги откладываешь, остальное тратишь.

---

ПРАВИЛО 2: КОНТРОЛИРУЙ СВОИ РАСХОДЫ

"Расходы растут вместе с доходом, если их не контролировать."

💡 Смысл:
Не важно, сколько зарабатываешь. Если тратишь всё — богатым не станешь.

Практика:
1. Записывай все расходы месяц.
2. Раздели на категории: необходимое, желаемое, лишнее.
3. Убери лишнее.

Пример:
Подписки, которые не используешь: Netflix, онлайн-курсы, спортзал.
Экономия: 2 000-5 000₽/месяц.

---

ПРАВИЛО 3: ЗАСТАВЬ ДЕНЬГИ РАБОТАТЬ

"Каждая монета, которую ты откладываешь — это раб, который работает на тебя."

💡 Смысл:
Инвестируй накопления. Пусть деньги приносят деньги.

Пример:
Вложил 100 000₽ под 10% годовых:
Через 1 год: 110 000₽ (+10 000₽)
Через 5 лет: 161 051₽ (+61 051₽)
Через 10 лет: 259 374₽ (+159 374₽)

Куда вкладывать?
- ETF на индексы
- Облигации
- Акции крупных компаний
- Недвижимость

---

ПРАВИЛО 4: ЗАЩИЩАЙ СВОИ СОКРОВИЩА ОТ ПОТЕРЬ

"Не вкладывай в то, чего не понимаешь."

💡 Смысл:
Избегай сомнительных проектов с обещаниями быстрой прибыли.

Примеры ошибок:
- Финансовые пирамиды ("удвоим за месяц!")
- Непроверенные криптопроекты
- Советы "друзей", которые сами не инвестируют

Как защититься?
- Изучай основы инвестиций
- Инвестируй только в надёжные инструменты
- Диверсифицируй

---

ПРАВИЛО 5: СДЕЛАЙ СВОЁ ЖИЛЬЁ ДОХОДНЫМ ВЛОЖЕНИЕМ

💡 Смысл:
Если платишь аренду — часть денег уходит навсегда.
Ипотека — это инвестиция в актив.

Пример:
Аренда 20 000₽/месяц = 240 000₽/год.
За 10 лет: 2 400 000₽ (деньги ушли владельцу).

Ипотека 20 000₽/месяц = за 10 лет квартира твоя + растёт в цене.

---

ПРАВИЛО 6: ОБЕСПЕЧЬ ДОХОД В БУДУЩЕМ

💡 Смысл:
Думай о пенсии. Государственной пенсии недостаточно.

Решение:
- Индивидуальный инвестиционный счёт (ИИС)
- Накопительное страхование жизни
- Инвестиции в ETF

Пример:
Вкладывай 5 000₽/месяц под 8% годовых 30 лет:
Итого: ~7 400 000₽.
Пассивный доход 8% = 592 000₽/год = 49 000₽/месяц.

---

ПРАВИЛО 7: УВЕЛИЧЬ СВОЮ СПОСОБНОСТЬ ЗАРАБАТЫВАТЬ

💡 Смысл:
Инвестируй в себя: образование, навыки, здоровье.

Как:
- Читай книги
- Проходи курсы
- Развивай востребованные навыки
- Работай над карьерой

Пример:
Курс программирования за 50 000₽ → зарплата выросла с 40 000₽ до 80 000₽.
Окупаемость: 2 месяца.

═══════════════════════════════════════════════════════════════

ГЛАВА 3. ПЯТЬ ЗАКОНОВ ЗОЛОТА

📌 Основная мысль:
Золото (деньги) подчиняется законам. Знай их — и богатство придёт.

ЗАКОН 1:
Золото приходит охотно и в увеличивающихся количествах к тому, кто
откладывает не менее 1/10 своего заработка на будущее.

ЗАКОН 2:
Золото работает усердно и плодотворно для мудрого владельца, который
находит ему прибыльное применение.

ЗАКОН 3:
Золото держится у того, кто вкладывает его в надёжные места и следует
советам мудрых.

ЗАКОН 4:
Золото убегает от того, кто вкладывает его в незнакомые дела или в проекты,
рекомендованные мошенниками.

ЗАКОН 5:
Золото убегает от того, кто ожидает нереалистичных прибылей или идёт на поводу
у своей неопытности.

═══════════════════════════════════════════════════════════════

ГЛАВА 4. ВСТРЕЧА В КАБАКЕ

📌 Основная мысль:
Удача любит действие. Чем больше пробуешь, тем больше шансов на успех.

История:
Группа друзей обсуждает удачу. Один говорит: "Удача — дело случая."
Богатый купец отвечает: "Нет! Удача приходит к тем, кто действует."

Пример:
Купец рассказывает, как в молодости упустил возможность купить землю за бесценок,
потому что медлил. Потом цена выросла в 10 раз.

💡 Урок:
Не жди идеального момента. Действуй сейчас!

═══════════════════════════════════════════════════════════════

ГЛАВА 5. ЗОЛОТОЙ РОСТОВЩИК ВАВИЛОНА

📌 Основная мысль:
Деньги нужно давать в долг только надёжным людям под залог.

История о Матоне, который научился давать деньги в рост:
"Я даю в долг только тем, у кого есть возможность вернуть. И только под залог."

💡 Урок для инвестора:
Не давай деньги друзьям "просто так". Если даёшь — оформляй договор.

═══════════════════════════════════════════════════════════════

ГЛАВА 6. СТЕНЫ ВАВИЛОНА

📌 Основная мысль:
Защищай свои активы. Страхуй риски.

Метафора:
Стены защищали Вавилон от врагов. Твоя финансовая защита:
- Подушка безопасности (3-6 месяцев расходов)
- Страхование жизни и здоровья
- Диверсификация инвестиций

═══════════════════════════════════════════════════════════════

ГЛАВА 7. РАБ, КОТОРЫЙ СТАЛ МИЛЛИОНЕРОМ

📌 Основная мысль:
Любой может стать богатым, если будет дисциплинирован и настойчив.

История Дабасира:
Был рабом. Освободился. Начал откладывать 10%. Погасил долги.
Стал богатым купцом.

Его секрет:
1. Отдавай 10% себе (накопления).
2. 20% — на погашение долгов.
3. 70% — на жизнь.

💡 Урок:
Начать никогда не поздно. Даже с нуля можно построить капитал.

═══════════════════════════════════════════════════════════════

ГЛАВА 8. ГЛИНЯНЫЕ ТАБЛИЧКИ ВАВИЛОНА

📌 Основная мысль:
Долги нужно погашать систематически. План работает!

История:
Археолог находит письма с планом погашения долгов 5000 лет назад.
План сработал!

Метод:
1. Составь список всех долгов.
2. Начни платить всем понемногу регулярно.
3. Не бери новых долгов.
4. Через время все долги погашены.

═══════════════════════════════════════════════════════════════

ГЛАВА 9. ВЕЗУНЧИК ИЗ ВАВИЛОНА

📌 Основная мысль:
Успех — это результат работы и правильных решений, а не везения.

💡 Урок:
Не жди удачи. Создавай её своим трудом и дисциплиной.

═══════════════════════════════════════════════════════════════

ИТОГОВЫЕ ВЫВОДЫ КНИГИ:

✅ Откладывай минимум 10% дохода
✅ Контролируй расходы
✅ Инвестируй накопления
✅ Защищай капитал
✅ Избегай сомнительных проектов
✅ Думай о будущем
✅ Учись и развивайся
✅ Будь дисциплинированным
✅ Действуй, не жди

Эти принципы работали 4000 лет назад. Работают и сейчas!

═══════════════════════════════════════════════════════════════
"""

# --- КНИГА 2: РАЗУМНЫЙ ИНВЕСТОР ---
INTELLIGENT_INVESTOR_BOOK = """
📖 РАЗУМНЫЙ ИНВЕСТОР — Бенджамин Грэм

═══════════════════════════════════════════════════════════════

ВВЕДЕНИЕ

Бенджамин Грэм — отец стоимостного инвестирования, учитель Уоррена Баффета.
Эта книга — библия инвесторов. Грэм учит инвестировать на основе анализа,
а не эмоций.

═══════════════════════════════════════════════════════════════

ГЛАВА 1. ИНВЕСТИЦИИ ПРОТИВ СПЕКУЛЯЦИЙ

📌 Основная мысль:
Инвестор и спекулянт — разные люди с разными целями.

ИНВЕСТОР:
- Анализирует компании
- Ищет недооценённые активы
- Держит долгосрочно (годы)
- Цель: стабильный рост капитала

СПЕКУЛЯНТ:
- Пытается угадать краткосрочные движения цен
- Торгует часто
- Цель: быстрая прибыль
- Риск: высокий

💡 Урок:
Будь инвестором, а не спекулянтом.

Пример:
Инвестор покупает акции Сбербанка и держит 10 лет → прибыль ~200%.
Спекулянт торгует каждый день → тратит время, платит комиссии, часто в убытке.

═══════════════════════════════════════════════════════════════

ГЛАВА 2. МАРЖА БЕЗОПАСНОСТИ

📌 Основная мысль:
Покупай активы дешевле их реальной стоимости.

Что это значит?
Если компания стоит 100₽, а её справедливая цена 150₽ → покупай.
Запас 50₽ — это маржа безопасности.

Зачем?
- Защита от ошибок оценки
- Защита от рыночных колебаний
- Потенциал роста

Пример:
Компания зарабатывает 10₽/акцию в год.
Справедливая цена: 10 × 15 = 150₽.
Рыночная цена: 100₽.
Маржа безопасности: 33%.

Покупаешь → через время рынок оценивает справедливо → прибыль 50%.

═══════════════════════════════════════════════════════════════

ГЛАВА 3. ИНВЕСТОР ЗАЩИЩАЮЩИЙСЯ И ПРЕДПРИИМЧИВЫЙ

📌 Основная мысль:
Выбери свою стратегию в зависимости от времени и знаний.

ЗАЩИЩАЮЩИЙСЯ ИНВЕСТОР:
- Минимум времени на анализ
- Простой портфель: 50% акции (ETF), 50% облигации
- Ребалансировка раз в год
- Цель: стабильность, минимум стресса

ПРЕДПРИИМЧИВЫЙ ИНВЕСТОР:
- Готов тратить время на анализ
- Выбирает отдельные акции
- Ищет недооценённые компании
- Цель: опередить рынок

💡 Урок:
Будь честен с собой. Если нет времени/желания — будь защищающимся инвестором.

Пример портфеля защищающегося инвестора:
- 50% FXRL (ETF на российские акции)
- 50% FXRB (ETF на российские облигации)
- Ребалансировка: раз в год приводишь к 50/50.

═══════════════════════════════════════════════════════════════

ГЛАВА 4. РЫНОЧНЫЕ КОЛЕБАНИЯ

📌 Основная мысль:
Рынок — это эмоциональный маятник между эйфорией и паникой.

Метафора мистера Рынка:
Представь, что у тебя есть деловой партнёр — мистер Рынок.
Каждый день он предлагает купить или продать твою долю в бизнесе.
Иногда цена разумная. Иногда — безумная (слишком высокая или низкая).

Твоя задача:
- Покупай, когда цена ниже справедливой
- Продавай, когда цена выше справедливой
- Игнорируй, когда цена нормальная

💡 Урок:
Не следуй за толпой. Покупай при панике, продавай при эйфории.

Пример:
2020 год, март: паника из-за COVID. Акции упали на 30%.
Инвесторы покупали → к концу года рост 50-100%.

═══════════════════════════════════════════════════════════════

ГЛАВА 5. ПСИХОЛОГИЯ ИНВЕСТОРА

📌 Основная мысль:
Главный враг инвестора — он сам.

Эмоции-убийцы прибыли:
1. ЖАДНОСТЬ: покупка на пике ("все покупают, и я куплю!")
2. СТРАХ: продажа в панике при падении
3. НЕТЕРПЕНИЕ: ожидание быстрой прибыли

Как бороться?
- Имей план
- Следуй ему механически
- Не смотри котировки каждый день
- Инвестируй регулярно независимо от рынка

Пример:
Инвестор покупает на 10 000₽ каждый месяц.
Рынок упал → покупает больше акций по низкой цене.
Рынок вырос → меньше акций, но предыдущие выросли.
Результат: усреднение цены, снижение риска.

═══════════════════════════════════════════════════════════════

ГЛАВА 6. ДИВЕРСИФИКАЦИЯ

📌 Основная мысль:
Не клади все яйца в одну корзину.

Почему?
- Одна компания может обанкротиться
- Один сектор может упасть
- Диверсификация снижает риск

Как диверсифицировать?
1. По активам: акции, облигации, недвижимость, валюта
2. По компаниям: 10-30 разных акций
3. По странам: российские и зарубежные активы
4. По секторам: технологии, финансы, энергетика, здравоохранение

Пример портфеля:
- 30% российские акции (FXRL)
- 20% зарубежные акции (FXWO)
- 30% облигации (FXRB)
- 10% золото (FXGD)
- 10% валюта (доллары)

═══════════════════════════════════════════════════════════════

ГЛАВА 7. ДОЛГОСРОЧНАЯ ПЕРСПЕКТИВА

📌 Основная мысль:
Инвестиции — это марафон, а не спринт.

Статистика:
- Средняя доходность фондового рынка за 100 лет: ~10% годовых
- Год к году: может быть +50% или -30%
- Но за 10-20 лет почти всегда положительная

Пример:
Вложил 100 000₽ под 10% годовых:
Через 10 лет: 259 374₽
Через 20 лет: 672 750₽
Через 30 лет: 1 744 940₽

💡 Урок:
Забудь про краткосрочные колебания. Думай десятилетиями.

═══════════════════════════════════════════════════════════════

ГЛАВА 8. АНАЛИЗ КОМПАНИЙ

📌 Основная мысль:
Инвестируй только в то, что понимаешь.

На что смотреть?
1. Прибыль: растёт ли из года в год?
2. Долги: не слишком ли большие?
3. Дивиденды: платит ли компания?
4. P/E (цена/прибыль): не переоценена ли акция?
5. Конкурентные преимущества: есть ли?

Пример анализа Сбербанка:
- Прибыль растёт: ✅
- Долги умеренные: ✅
- Дивиденды 8-10%: ✅
- P/E ~5 (низкий): ✅
- Лидер рынка: ✅
→ Хорошая инвестиция для долгосрочного портфеля.

═══════════════════════════════════════════════════════════════

ИТОГОВЫЕ ВЫВОДЫ КНИГИ:

✅ Инвестируй на основе анализа, а не эмоций
✅ Покупай с маржой безопасности
✅ Диверсифицируй
✅ Думай долгосрочно
✅ Не пытайся угадать рынок
✅ Будь дисциплинированным
✅ Учись постоянно

"Инвестирование — это не игра. Это серьёзная работа." — Бенджамин Грэм

═══════════════════════════════════════════════════════════════
"""

# --- ПОДРОБНЫЙ ПЛАН ИНВЕСТИЦИЙ ДЛЯ НАЧИНАЮЩИХ ---
DETAILED_INVESTMENT_PLAN = """
📋 ПОДРОБНЫЙ ПЛАН ИНВЕСТИЦИЙ ДЛЯ НАЧИНАЮЩИХ

═══════════════════════════════════════════════════════════════

ШАГ 1. ПОДГОТОВКА К ИНВЕСТИЦИЯМ

═══════════════════════════════════════════════════════════════

1.1. СОЗДАЙ ФИНАНСОВУЮ ПОДУШКУ БЕЗОПАСНОСТИ

Что это?
Сумма на 3-6 месяцев текущих расходов на случай потери работы, болезни и т.д.

Как рассчитать?
Расходы в месяц × 3 (минимум) или × 6 (оптимально).

Пример:
Расходы 30 000₽/месяц → подушка 90 000 - 180 000₽.

Где хранить?
- Накопительный счёт в банке (Сбер, Тинькофф, ВТБ)
- Доходность ~8-12% годовых
- Мгновенный доступ к деньгам

❗ ВАЖНО: Начинай инвестировать только после создания подушки!

---

1.2. ОПРЕДЕЛИ ФИНАНСОВЫЕ ЦЕЛИ

Зачем инвестируешь?
- Пенсия (долгосрок, 20-30 лет)
- Квартира (среднесрок, 5-10 лет)
- Образование детей (среднесрок, 10-15 лет)
- Пассивный доход (долгосрок, 10+ лет)

Пример:
Цель: через 10 лет накопить 2 000 000₽ на квартиру.
Сколько вкладывать ежемесячно при доходности 10%?
Ответ: ~10 500₽/месяц.

Используй онлайн-калькуляторы сложного процента.

---

1.3. ОЦЕНИ СВОЙ РИСК-ПРОФИЛЬ

Три типа инвесторов:

КОНСЕРВАТИВНЫЙ:
- Не готов терпеть просадки больше 10%
- Портфель: 70-80% облигации, 20-30% акции
- Ожидаемая доходность: 8-10% годовых

УМЕРЕННЫЙ:
- Готов терпеть просадки 20-30%
- Портфель: 50% акции, 50% облигации
- Ожидаемая доходность: 10-12% годовых

АГРЕССИВНЫЙ:
- Готов терпеть просадки 40-50%
- Портфель: 70-90% акции, 10-30% облигации
- Ожидаемая доходность: 12-15% годовых

💡 Совет: Начни с консервативного или умеренного портфеля.

---

1.4. ИЗУЧИ ОСНОВЫ

Что нужно знать минимум?
✅ Что такое акции, облигации, ETF
✅ Что такое дивиденды и купоны
✅ Как работает брокерский счёт
✅ Что такое диверсификация
✅ Базовые налоги на инвестиции (13% НДФЛ)

Где учиться?
- Книги: "Разумный инвестор", "Самый богатый человек в Вавилоне"
- YouTube-каналы брокеров (Тинькофф, Сбер)
- Блоги: smart-lab.ru, blog.tinkoff.ru

Время: 2-4 недели базового обучения.

═══════════════════════════════════════════════════════════════

ШАГ 2. ОТКРЫТИЕ БРОКЕРСКОГО СЧЁТА

═══════════════════════════════════════════════════════════════

2.1. ВЫБОР БРОКЕРА

Лучшие брокеры для новичков (РФ):
1. Тинькофф Инвестиции
2. Сбер Инвестор
3. ВТБ Мои Инвестиции

На что смотреть?
✅ Комиссии (чем ниже, тем лучше)
✅ Удобство приложения
✅ Наличие обучающих материалов
✅ Поддержка

Комиссии (примерно):
- Покупка/продажа акций: 0.05-0.3% от сделки
- Обслуживание счёта: 0-300₽/месяц
- Вывод денег: обычно бесплатно

💡 Совет: Начни с Тинькофф или Сбер — удобные приложения, много обучалки.

---

2.2. ТИП СЧЁТА

Два варианта:

ОБЫЧНЫЙ БРОКЕРСКИЙ СЧЁТ:
- Нет ограничений на вывод
- Налог 13% с прибыли
- Льгота: если держишь акции 3+ года → налог 0% (до 3 млн₽/год)

ИНДИВИДУАЛЬНЫЙ ИНВЕСТИЦИОННЫЙ СЧЁТ (ИИС):
- Ограничение: нельзя выводить 3 года
- Максимум 1 млн₽ пополнений в год
- Налоговый вычет:
  Тип А: возврат 13% с взноса (до 52 000₽/год)
  Тип Б: 0% налог с прибыли

💡 Для долгосрока (3+ года): открывай ИИС тип А.

Пример:
Внёс 400 000₽ на ИИС → вернул 13% = 52 000₽ от государства.
Это +13% к доходности сразу!

---

2.3. ПРОЦЕСС ОТКРЫТИЯ

1. Скачай приложение брокера
2. Пройди регистрацию (паспорт, ИНН)
3. Открой счёт (обычный или ИИС)
4. Пополни счёт (переводом с карты)

Время: 10-30 минут.

═══════════════════════════════════════════════════════════════

ШАГ 3. ФОРМИРОВАНИЕ ПОРТФЕЛЯ

═══════════════════════════════════════════════════════════════

3.1. СТРАТЕГИЯ ДЛЯ НОВИЧКА: ПОРТФЕЛЬ ИЗ ETF

Что такое ETF?
Это фонд, который автоматически покупает много акций/облигаций по индексу.
Ты покупаешь одну бумагу → получаешь диверсификацию.

Преимущества ETF:
✅ Мгновенная диверсификация
✅ Низкие комиссии
✅ Не нужно выбирать отдельные акции
✅ Прост в управлении

Популярные ETF (Россия):
- FXRL: российские акции (индекс Мосбиржи)
- FXRB: российские облигации
- FXWO: мировые акции
- FXGD: золото
- FXUS: акции США

---

3.2. ПРИМЕРЫ ПОРТФЕЛЕЙ ДЛЯ НОВИЧКОВ

КОНСЕРВАТИВНЫЙ ПОРТФЕЛЬ:
- 70% FXRB (облигации)
- 30% FXRL (акции)

Ожидаемая доходность: 8-10% годовых.
Риск: низкий.

---

СБАЛАНСИРОВАННЫЙ ПОРТФЕЛЬ:
- 50% FXRL (российские акции)
- 30% FXRB (облигации)
- 20% FXUS (акции США)

Ожидаемая доходность: 10-12% годовых.
Риск: средний.

---

АГРЕССИВНЫЙ ПОРТФЕЛЬ:
- 60% FXRL (российские акции)
- 20% FXUS (акции США)
- 10% FXGD (золото)
- 10% FXRB (облигации)

Ожидаемая доходность: 12-15% годовых.
Риск: высокий.

💡 Совет: Начни со сбалансированного портфеля.

---

3.3. ПЕРВАЯ ПОКУПКА

Сколько вкладывать?
Начни с 10 000-50 000₽ для теста.
Потом добавляй регулярно (каждый месяц).

Как купить ETF?
1. Открой приложение брокера
2. Найди тикер (например, FXRL)
3. Нажми "Купить"
4. Укажи количество лотов
5. Подтверди покупку

Время: 2 минуты.

═══════════════════════════════════════════════════════════════

ШАГ 4. РЕГУЛЯРНЫЕ ИНВЕСТИЦИИ

═══════════════════════════════════════════════════════════════

4.1. ПРИНЦИП УСРЕДНЕНИЯ

Не пытайся угадать "дно". Покупай регулярно!

Стратегия DCA (Dollar Cost Averaging):
Вкладываешь фиксированную сумму каждый месяц независимо от цены.

Пример:
Каждый месяц покупаешь на 10 000₽ акций.
- Январь: цена 100₽ → купил 100 акций
- Февраль: цена 80₽ → купил 125 акций (рынок упал — выгодно!)
- Март: цена 120₽ → купил 83 акции

Средняя цена: ниже, чем если бы купил всё в январе.

💡 Главное: регулярность, а не попытки угадать рынок.

---

4.2. АВТОМАТИЗАЦИЯ

Настрой автоинвестирование:
- В приложении брокера есть функция автопокупки
- Указываешь сумму и дату (например, 5-го числа каждого месяца)
- Бот автоматически покупает выбранные активы

Преимущества:
✅ Не забудешь инвестировать
✅ Эмоции не влияют
✅ Экономишь время

═══════════════════════════════════════════════════════════════

ШАГ 5. РЕБАЛАНСИРОВКА ПОРТФЕЛЯ

═══════════════════════════════════════════════════════════════

Что это?
Возврат портфеля к целевой структуре.

Пример:
Твой портфель: 50% акции, 50% облигации.
Через год акции выросли → 60% акции, 40% облигации.

Ребалансировка:
Продай 10% акций → купи облигации → вернись к 50/50.

Как часто?
Раз в год (например, в январе).

Зачем?
- Фиксируешь прибыль
- Снижаешь риск
- Дисциплина

═══════════════════════════════════════════════════════════════

ШАГ 6. МОНИТОРИНГ И КОРРЕКТИРОВКА

═══════════════════════════════════════════════════════════════

6.1. КАК ЧАСТО СМОТРЕТЬ ПОРТФЕЛЬ?

Рекомендация: раз в квартал.

НЕ смотри каждый день!
Причины:
- Вызывает стресс
- Подталкивает к импульсивным решениям
- Краткосрочные колебания не важны

---

6.2. КОГДА ПРОДАВАТЬ?

Продавай только если:
1. Достиг цели (накопил нужную сумму)
2. Изменились обстоятельства (нужны деньги срочно)
3. Фундаментально изменилась компания (для отдельных акций)

НЕ продавай:
❌ При падении рынка ("все продают!")
❌ При росте рынка ("зафиксирую прибыль!")
❌ По совету друзей/форумов

💡 Держи план. Следуй ему.

═══════════════════════════════════════════════════════════════

ШАГ 7. ТИПИЧНЫЕ ОШИБКИ НОВИЧКОВ (И КАК ИХ ИЗБЕЖАТЬ)

═══════════════════════════════════════════════════════════════

ОШИБКА 1: Начинаю без подушки безопасности
Последствия: При первой проблеме придётся продать в убыток.
Решение: Сначала подушка, потом инвестиции.

---

ОШИБКА 2: Вкладываю все деньги разом
Последствия: Купил на пике → рынок упал → убыток.
Решение: Инвестируй регулярно (DCA).

---

ОШИБКА 3: Покупаю "модные" акции без анализа
Последствия: Часто это пузыри → резкое падение.
Решение: Придерживайся ETF или изучай компании перед покупкой.

---

ОШИБКА 4: Паникую при падении и продаю
Последствия: Фиксирую убыток, упускаю восстановление.
Решение: Помни: рынок всегда растёт долгосрочно.

---

ОШИБКА 5: Не диверсифицирую
Последствия: Одна акция упала → потерял всё.
Решение: Минимум 10 разных бумаг или ETF.

═══════════════════════════════════════════════════════════════

ШАГ 8. РАСЧЁТ БУДУЩЕГО КАПИТАЛА

═══════════════════════════════════════════════════════════════

Формула сложного процента:

FV = PV × (1 + r)^n + PMT × [((1 + r)^n - 1) / r]

Где:
FV = будущая стоимость
PV = начальная сумма
r = годовая доходность
n = количество лет
PMT = ежемесячный взнос

Пример расчёта:
Начальная сумма: 50 000₽
Ежемесячный взнос: 10 000₽
Доходность: 10% годовых
Срок: 10 лет

Результат: ~2 100 000₽

Из них:
- Твои взносы: 50 000 + (10 000 × 12 × 10) = 1 250 000₽
- Доход от инвестиций: 850 000₽

💡 Сложный процент творит чудеса при долгосроке!

═══════════════════════════════════════════════════════════════

ИТОГОВЫЙ ЧЕКЛИСТ ДЛЯ НОВИЧКА

═══════════════════════════════════════════════════════════════

□ Создал финансовую подушку (3-6 месяцев расходов)
□ Определил финансовые цели и срок
□ Оценил свой риск-профиль
□ Изучил основы инвестиций
□ Выбрал брокера и открыл счёт (ИИС или обычный)
□ Сформировал портфель (начал с ETF)
□ Совершил первую покупку
□ Настроил регулярные инвестиции (автопокупка)
□ Запланировал ребалансировку (раз в год)
□ Настроился на долгосрок (10+ лет)

═══════════════════════════════════════════════════════════════

ГЛАВНЫЕ ПРИНЦИПЫ УСПЕШНОГО ИНВЕСТОРА

═══════════════════════════════════════════════════════════════

1. НАЧНИ СЕЙЧАС — время дороже денег
2. РЕГУЛЯРНОСТЬ — лучше 5 000₽ каждый месяц, чем 60 000₽ раз в год
3. ДИСЦИПЛИНА — следуй плану несмотря на эмоции
4. ДОЛГОСРОК — думай десятилетиями
5. ОБУЧЕНИЕ — учись постоянно
6. ПРОСТОТА — не усложняй (ETF достаточно)
7. ТЕРПЕНИЕ — богатство растёт медленно

═══════════════════════════════════════════════════════════════

ДОПОЛНИТЕЛЬНЫЕ РЕСУРСЫ

═══════════════════════════════════════════════════════════════

Книги:
- "Разумный инвестор" — Бенджамин Грэм
- "Самый богатый человек в Вавилоне" — Джордж Клейсон
- "Думай и богатей" — Наполеон Хилл
- "Богатый папа, бедный папа" — Роберт Кийосаки

Сайты:
- smart-lab.ru — аналитика и обсуждения
- investing.com — котировки и новости
- cbr.ru — Центробанк РФ

YouTube-каналы:
- Тинькофф Инвестиции
- Сбер — Инвестиции
- Школа разумного инвестирования

═══════════════════════════════════════════════════════════════

Помни: инвестиции — это марафон, а не спринт.
Удачи на пути к финансовой свободе! 🚀

═══════════════════════════════════════════════════════════════
"""

# --- ДОПОЛНИТЕЛЬНЫЕ РАЗДЕЛЫ ---

GLOSSARY = """
📖 СЛОВАРЬ ИНВЕСТОРА

═══════════════════════════════════════════════════════════════

АКЦИЯ — ценная бумага, доля в компании. Даёт право на часть прибыли (дивиденды).

ОБЛИГАЦИЯ — долговая ценная бумага. Компания/государство занимает у тебя деньги
и платит проценты (купоны).

ETF (Exchange Traded Fund) — биржевой фонд. Корзина акций/облигаций, торгуется
как одна бумага.

ДИВИДЕНДЫ — часть прибыли компании, выплачиваемая акционерам.

КУПОН — процентный платёж по облигации.

БРОКЕР — посредник между тобой и биржей.

БИРЖА — площадка, где покупаются/продаются ценные бумаги.

ДИВЕРСИФИКАЦИЯ — распределение денег между разными активами для снижения риска.

РЕБАЛАНСИРОВКА — возврат портфеля к целевой структуре.

ВОЛАТИЛЬНОСТЬ — степень колебания цены актива.

ЛИКВИДНОСТЬ — насколько быстро актив можно продать без потери стоимости.

P/E (Price/Earnings) — отношение цены акции к прибыли компании. Показывает,
переоценена ли акция.

МАРЖА БЕЗОПАСНОСТИ — разница между рыночной ценой и справедливой стоимостью.

ИИС (Индивидуальный Инвестиционный Счёт) — счёт с налоговыми льготами.

СЛОЖНЫЙ ПРОЦЕНТ — начисление процентов на проценты.

ДОХОДНОСТЬ — прибыль в процентах за период.

ПРОСАДКА — падение стоимости портфеля от максимума.

ИНДЕКС — показатель, отражающий состояние рынка (например, индекс Мосбиржи).

ГОЛУБЫЕ ФИШКИ — акции крупнейших надёжных компаний.

ОБЛИГАЦИИ ФЕДЕРАЛЬНОГО ЗАЙМА (ОФЗ) — облигации государства РФ. Очень надёжные.

═══════════════════════════════════════════════════════════════
"""

PSYCHOLOGY = """
🧠 ПСИХОЛОГИЯ ИНВЕСТОРА

═══════════════════════════════════════════════════════════════

ГЛАВНЫЕ ПСИХОЛОГИЧЕСКИЕ ЛОВУШКИ

═══════════════════════════════════════════════════════════════

1. ЭФФЕКТ ТОЛПЫ
"Все покупают, и я куплю!"

Опасность: Покупка на пике пузыря.
Решение: Думай своей головой. Анализируй.

---

2. СТРАХ УПУЩЕННОЙ ВЫГОДЫ (FOMO — Fear Of Missing Out)
"Акция выросла на 50%. Надо срочно купить!"

Опасность: Покупка переоценённого актива.
Решение: Придерживайся своей стратегии.

---

3. ПАНИКА ПРИ ПАДЕНИИ
"Рынок рухнул! Продаю всё!"

Опасность: Фиксация убытков. Упущенное восстановление.
Решение: Помни: рынок всегда восстанавливается долгосрочно.

---

4. ЖАДНОСТЬ НА ПИКЕ
"Акция выросла в 2 раза. Ещё вырастет!"

Опасность: Не зафиксированная прибыль. Последующее падение.
Решение: Имей план выхода. Следуй ему.

---

5. САМОУВЕРЕННОСТЬ ПОСЛЕ ПЕРВОЙ ПРИБЫЛИ
"Я заработал 20% за месяц. Я гений!"

Опасность: Увеличение рисков. Потеря бдительности.
Решение: Будь скромным. Рынок учит смирению.

═══════════════════════════════════════════════════════════════

КАК КОНТРОЛИРОВАТЬ ЭМОЦИИ?

═══════════════════════════════════════════════════════════════

1. ИМЕЙ ЧЁТКИЙ ПЛАН
Запиши стратегию. Следуй ей механически.

2. НЕ СМОТРИ КОТИРОВКИ КАЖДЫЙ ДЕНЬ
Чем реже смотришь, тем спокойнее.

3. ВЕДИ ДНЕВНИК ИНВЕСТОРА
Записывай решения и причины. Анализируй ошибки.

4. АВТОМАТИЗИРУЙ ИНВЕСТИЦИИ
Настрой автопокупку → убери эмоциональный фактор.

5. ЧИТАЙ ИСТОРИИ УСПЕШНЫХ ИНВЕСТОРОВ
Они тоже ошибались. Учись на их опыте.

6. ПОМНИ О ЦЕЛИ
Зачем инвестируешь? Пенсия? Квартира? Держи цель перед глазами.

═══════════════════════════════════════════════════════════════

ЦИТАТЫ ДЛЯ МОТИВАЦИИ

═══════════════════════════════════════════════════════════════

"Будь жадным, когда другие боятся. Бойся, когда другие жадны." — Уоррен Баффет

"Инвестирование успешно, когда оно деловито." — Бенджамин Грэм

"Лучшее время посадить дерево было 20 лет назад. Второе лучшее время — сейчас."

"Сложный процент — восьмое чудо света." — Альберт Эйнштейн

"Не нужно делать необычные вещи, чтобы получить необычные результаты." — Уоррен Баффет

═══════════════════════════════════════════════════════════════
"""

# ========================================
# КЛАСС БОТА
# ========================================

class InvestmentSuperBot:
    def __init__(self):
        self.init_db()

    def init_db(self):
        con = sqlite3.connect("users.db")
        cur = con.cursor()
        cur.execute(
            "CREATE TABLE IF NOT EXISTS user_stats (user_id INTEGER PRIMARY KEY, name TEXT, questions_count INTEGER, last_visit TEXT)"
        )
        con.commit()
        con.close()

    def update_user_stat(self, user_id, name):
        con = sqlite3.connect("users.db")
        cur = con.cursor()
        cur.execute(
            "INSERT OR IGNORE INTO user_stats (user_id, name, questions_count, last_visit) VALUES (?, ?, 0, datetime('now'))",
            (user_id, name)
        )
        cur.execute(
            "UPDATE user_stats SET last_visit=datetime('now') WHERE user_id=?",
            (user_id,)
        )
        con.commit()
        con.close()

    def increment_questions(self, user_id):
        con = sqlite3.connect("users.db")
        cur = con.cursor()
        cur.execute(
            "UPDATE user_stats SET questions_count = questions_count + 1 WHERE user_id=?",
            (user_id,)
        )
        con.commit()
        con.close()

    def get_main_menu(self):
        return ReplyKeyboardMarkup([
            ["📚 Книги", "📋 План инвестиций", "🧠 Психология"],
            ["📖 Словарь", "📊 Статистика", "Главное меню"],
        ], resize_keyboard=True)

    def get_books_menu(self):
        return ReplyKeyboardMarkup([
            ["Самый богатый человек в Вавилоне"],
            ["Разумный инвестор"],
            ["Главное меню"]
        ], resize_keyboard=True)

    async def start(self, update: Update, context: CallbackContext):
        user = update.effective_user
        self.update_user_stat(user.id, user.first_name)
        text = (
            f"Привет, {user.first_name}! 👋\n\n"
            "Я самый подробный бот по инвестициям и финансовой грамотности!\n\n"
            "У меня есть:\n"
            "📚 Полные книги с детальным разбором каждой главы\n"
            "📋 Подробнейший план инвестиций для начинающих\n"
            "🧠 Психология инвестора\n"
            "📖 Словарь терминов\n\n"
            "Выбери раздел в меню!"
        )
        await update.message.reply_text(text, reply_markup=self.get_main_menu())

    async def send_long_text(self, text, update: Update, keyboard=None):
        """Отправка длинных текстов частями (Telegram ограничивает 4096 символов)"""
        max_length = 4000
        parts = [text[i:i+max_length] for i in range(0, len(text), max_length)]
        for i, part in enumerate(parts):
            if i == len(parts) - 1 and keyboard:
                await update.message.reply_text(part, reply_markup=keyboard)
            else:
                await update.message.reply_text(part)

    async def show_books(self, update: Update, context: CallbackContext):
        await update.message.reply_text("📚 Выбери книгу:", reply_markup=self.get_books_menu())

    async def show_babylon_book(self, update: Update, context: CallbackContext):
        await self.send_long_text(BABYLON_BOOK, update, self.get_books_menu())

    async def show_investor_book(self, update: Update, context: CallbackContext):
        await self.send_long_text(INTELLIGENT_INVESTOR_BOOK, update, self.get_books_menu())

    async def show_investment_plan(self, update: Update, context: CallbackContext):
        await self.send_long_text(DETAILED_INVESTMENT_PLAN, update, self.get_main_menu())

    async def show_glossary(self, update: Update, context: CallbackContext):
        await self.send_long_text(GLOSSARY, update, self.get_main_menu())

    async def show_psychology(self, update: Update, context: CallbackContext):
        await self.send_long_text(PSYCHOLOGY, update, self.get_main_menu())

    async def show_stats(self, update: Update, context: CallbackContext):
        user = update.effective_user
        con = sqlite3.connect("users.db")
        cur = con.cursor()
        cur.execute("SELECT questions_count, last_visit FROM user_stats WHERE user_id=?", (user.id,))
        row = cur.fetchone()
        con.close()
        if row:
            text = f"📊 Твоя статистика:\n\nВопросов задано: {row[0]}\nПоследний визит: {row[1]}"
        else:
            text = "Статистика пока пуста."
        await update.message.reply_text(text, reply_markup=self.get_main_menu())

    async def handle_message(self, update: Update, context: CallbackContext):
        user = update.effective_user
        self.update_user_stat(user.id, user.first_name)
        self.increment_questions(user.id)
        msg = update.message.text.strip().lower()

        if "главное меню" in msg or msg == "главное меню":
            await self.start(update, context)
        elif "книг" in msg or msg == "📚 книги":
            await self.show_books(update, context)
        elif "вавилон" in msg:
            await self.show_babylon_book(update, context)
        elif "разумный инвестор" in msg:
            await self.show_investor_book(update, context)
        elif "план" in msg or msg == "📋 план инвестиций":
            await self.show_investment_plan(update, context)
        elif "словарь" in msg or msg == "📖 словарь":
            await self.show_glossary(update, context)
        elif "психолог" in msg or msg == "🧠 психология":
            await self.show_psychology(update, context)
        elif "статистика" in msg or msg == "📊 статистика":
            await self.show_stats(update, context)
        else:
            await update.message.reply_text(
                "Не понял запрос. Используй кнопки меню!",
                reply_markup=self.get_main_menu()
            )

    def setup_handlers(self, application):
        application.add_handler(CommandHandler("start", self.start))
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, self.handle_message))

def main():
    print("🚀 Запуск подробного бота по инвестициям...")
    bot = InvestmentSuperBot()
    application = Application.builder().token(BOT_TOKEN).build()
    bot.setup_handlers(application)
    print("✅ Бот работает! Пиши /start в Telegram")
    application.run_polling()

if __name__ == "__main__":
    main()

